{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 6260dbfcedbd2cc4cf2c","webpack:///./src/scss/canvastools.scss","webpack:///./src/js/closet.js","webpack:///./src/js/template.js","webpack:///./src/js/utils.js","webpack:///./src/js/main.js"],"names":["window","Element","prototype","closest","s","matches","document","ownerDocument","querySelectorAll","i","el","length","item","parentElement","ButtonsMap","rect","panel","name","ellipse","brush","arrow","mosaic","font","rubber","undo","save","ColorList","FontSize","StrokeWidth","getButtons","buttons","html","useButton","indexOf","btn","key","push","join","getColorPanel","color","items1","items2","getStrokePanel","stroke","len","size","classes","getFontPanel","fontSize","selected","getAmbiguity","ambiguite","ArrayProto","Array","SelectorRegs","id","className","tagName","isObject","obj","isPlainObject","Object","toString","call","$","selector","context","trim","dom","test","getElementById","RegExp","$1","getElementsByClassName","getElementsByTagName","slice","each","object","callback","isArray","k","bind","element","eventType","sel","handler","e","nodes","matched","node","target","contains","apply","arguments","addEventListener","unbind","removeEventListener","getComputedStyles","defaultView","getComputedStyle","extend","out","keys","hasOwnProperty","$on","elements","index","$off","classList","type","STROKE_TYPES","STROKE_DEFAULT_COLOR","STROKE_DEFAULT_WIDTH","TEXT_HELPER_PADDING","TEXT_HELPER_ZINDEX","TEXT_HELPER_ID","TEXT_HELPER_FONT_SIZE","TEXT_FONT_FAMILY","AMBIGUITY_LEVEL","buildStrokePanel","createElement","style","cssText","innerHTML","buildFontPanel","buildAmbiguityPanel","ambiguity","getTextHelper","$textHelper","setAttribute","body","appendChild","insertTextHelper","event","state","threshold","padding","pos","getPos","x","pageX","y","pageY","maxW","Math","floor","width","maxH","height","styleMap","display","position","top","left","strokeColor","overflow","focus","removeTextHelper","defaults","container","$saveLink","createElementNS","canUseSaveLink","__downloadFile","fileName","Date","now","canvas","fileUrl","toDataURL","replace","setTimeout","href","download","dispatchEvent","MouseEvent","navigator","msToBlob","msSaveBlob","console","log","__bindEvents","self","$el","config","_handles","history","$btns","$fontPanel","$strokePanel","$mosaicPanel","$colorSelected","$colors","$strokeWidth","$fontSize","$mosaicAmbiguity","btnEmit","stopPropagation","drawType","__drawFont","getAttribute","value","$btn","isActive","visible","pop","putImageData","__toggleCanvasCursor","toggleColor","background","toggleStrokeWidth","strokeWidth","Number","method","toggleFontSize","_startPos","onMouseDown","lastImageData","getImageData","lineCap","lineJoin","shadowBlur","strokeStyle","lineWidth","__drawRect","__drawEllipse","__drawMoasic","__drawBrush","onMouseMove","onMouseUp","__pushHistory","isEntry","resize","_rect","getBoundingClientRect","offsetWidth","offsetHeight","toggleAmbiguity","start","clearRect","beginPath","strokeRect","restore","closePath","scaleX","scaleY","scale","arc","PI","moveTo","lineTo","content","textContent","parseFloat","lastSubStrIndex","fillStyle","char","measureText","fillText","substring","pixel","data","fillRect","cursor","CanvasTools","options","getContext","Error","create","render","C","S","parentNoed","removeChild"],"mappings":"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","file":"canvastools.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"CanvasTools\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"CanvasTools\"] = factory();\n\telse\n\t\troot[\"CanvasTools\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6260dbfcedbd2cc4cf2c","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/scss/canvastools.scss\n// module id = 0\n// module chunks = 0","//Element.closet Polyfill\r\n//https://developer.mozilla.org/en-US/docs/Web/API/Element/closest\r\nif (window.Element && !Element.prototype.closest) {\r\n    Element.prototype.closest =\r\n        function(s) {\r\n            var matches = (this.document || this.ownerDocument).querySelectorAll(s),\r\n                i,\r\n                el = this;\r\n            do {\r\n                i = matches.length;\r\n                while (--i >= 0 && matches.item(i) !== el) {};\r\n            } while ((i < 0) && (el = el.parentElement));\r\n            return el;\r\n        };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/js/closet.js","const ButtonsMap = {\r\n\trect: {\r\n\t\tpanel: 'stroke',\r\n\t\tname: '矩形工具'\r\n\t},\r\n\tellipse: {\r\n\t\tpanel: 'stroke',\r\n\t\tname: '椭圆工具'\r\n\t},\r\n\tbrush: {\r\n\t\tpanel: 'stroke',\r\n\t\tname: '画笔工具'\r\n\t},\r\n\tarrow: {\r\n\t\tpanel: 'stroke',\r\n\t\tname: '箭头工具'\r\n\t},\r\n\tmosaic: {\r\n\t\tpanel: 'mosaic',\r\n\t\tname: '马赛克工具'\r\n\t},\r\n\tfont: {\r\n\t\tpanel: 'font',\r\n\t\tname: '文字工具'\r\n\t},\r\n\trubber: {\r\n\t\tname: '橡皮擦'\r\n\t},\r\n\tundo: {\r\n\t\tname: '撤销操作'\r\n\t},\r\n\tsave: {\r\n\t\tname: '保存'\r\n\t}\r\n}\r\n\r\n\r\n//可用颜色\r\nconst ColorList = ['#000000', '#808080', '#800000', '#f7883a', '#308430', '#385ad3', '#800080', '#009999', '#ffffff', '#c0c0c0', '#fb3838', '#ffff00', '#99cc00', '#3894e4', '#f31bf3', '#16dcdc']\r\n\r\n//可选择字号，Chrome不支持小于12号的字体\r\nconst FontSize = [12, 14, 16, 18, 20, 22]\r\n\r\n//画笔大小\r\nconst StrokeWidth = [2, 4, 6]\r\n\r\n\r\n/**\r\n * 获取buttons模版\r\n * @param  {Array}  buttons [可用按钮]\r\n * @return {String} \r\n */\r\nconst getButtons = (buttons = []) => {\r\n\tlet html = []\r\n\tconst useButton = btn => {\r\n\t\treturn buttons && !!~buttons.indexOf(btn)\r\n\t}\r\n\tfor (let key in ButtonsMap) {\r\n\t\tif (useButton(key)) {\r\n\t\t\tlet btn = ButtonsMap[key]\r\n\t\t\thtml.push(`<div class=\"canvas-tools-btn js-btn\" data-panel=\"${btn.panel || ''}\" data-value=\"${key}\" data-action=\"\" title=\"${btn.name}\">\r\n\t\t\t<a class=\"btn-toggle\"><i class=\"canvas-tools-icon__${key}\"></i></a>\r\n\t\t\t</div>`)\r\n\t\t}\r\n\t}\r\n\treturn html.join('')\r\n}\r\n\r\n\r\n/**\r\n * 获取颜色面板\r\n * @param  {String} color [当前选中色]\r\n * @return {String}\r\n */\r\nconst getColorPanel = (color = '#fb3838') => {\r\n\tlet html = ''\r\n\thtml += '<div class=\"colors\">'\r\n\thtml += `<span class=\"color-selected\"><i class=\"js-color-selected\" style=\"background:${color}\"></i></span>`\r\n\thtml += '<div class=\"color-list\">'\r\n\r\n\tlet items1 = [],\r\n\t\titems2 = []\r\n\tfor (let i = 0; i < 16; i++) {\r\n\t\tlet item = `<li class=\"js-color\" style=\"background:${ColorList[i]}\" data-value=\"${ColorList[i]}\"></li>`\r\n\t\tif (i < 8) {\r\n\t\t\titems1.push(item)\r\n\t\t} else {\r\n\t\t\titems2.push(item)\r\n\t\t}\r\n\t}\r\n\r\n\thtml += `<ul>${items1.join('')}</ul>`\r\n\thtml += `<ul>${items2.join('')}</ul>`\r\n\r\n\thtml += '</div>'\r\n\thtml += '</div>'\r\n\r\n\treturn html\r\n}\r\n\r\n\r\n/**\r\n * 获取画笔大小面板\r\n * @param  {Number} stroke [当前画笔大小]\r\n * @return {String}  \r\n */\r\nconst getStrokePanel = (stroke = 2) => {\r\n\tlet html = '<div class=\"strokes\">'\r\n\tfor (let i = 0, len = StrokeWidth.length; i < len; i++) {\r\n\t\tlet size = StrokeWidth[i]\r\n\t\tlet classes = ['stroke', 'js-stroke-width']\r\n\t\tsize === stroke && classes.push('active')\r\n\t\thtml += `<a class=\"${classes.join(' ')}\" data-value=\"${size}\"><i style=\"width:${size + 1}px;height:${size + 1}px;\"></i></a>`\r\n\t}\r\n\thtml += '</div>'\r\n\treturn html\r\n}\r\n\r\n\r\n/**\r\n * 获取字号选择器\r\n * @param  {Number} fontSize [默认字号]\r\n * @return {String} \r\n */\r\nconst getFontPanel = (fontSize = 12) => {\r\n\tlet html = '<select class=\"font-select js-font-size\">'\r\n\tfor (let i = 0, len = FontSize.length; i < len; i++) {\r\n\t\tlet size = FontSize[i]\r\n\t\tlet selected = !!(size === fontSize) ? 'selected' : ''\r\n\t\thtml += `<option value=\"${size}\" ${selected}>${size}</option>`\r\n\t}\r\n\thtml += '</select>'\r\n\treturn html\r\n}\r\n\r\n\r\nconst getAmbiguity = (ambiguite = .5) => `<label class=\"ambiguite-range\"><span>模糊度</span><input type=\"range\" min=\"0\" step=\"0.01\" max=\"1\" value=\"${ambiguite}\" class=\"js-mosaic-ambiguity\"></label>`\r\n\r\nexport default {\r\n\tgetButtons,\r\n\tgetColorPanel,\r\n\tgetStrokePanel,\r\n\tgetFontPanel,\r\n\tgetAmbiguity,\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/js/template.js","const ArrayProto = Array.prototype\r\n\r\nconst SelectorRegs = {\r\n\tid: /^#([\\w-]+)$/,\r\n\tclassName: /^\\.([\\w-]+)$/,\r\n\ttagName: /^[\\w-]+$/\r\n}\r\n\r\n\r\nconst isObject = obj => obj !== null && typeof obj === 'object'\r\n\r\n\r\nconst isPlainObject = obj => Object.prototype.toString.call(obj) === '[object Object]'\r\n\r\n\r\n\r\n/**\r\n * 获取元素对象集合\r\n * @param  {String} selector [选择器]\r\n * @param  {HTMLElement} context  [上下文对象]\r\n * @return {Array}          [元素节点集合]\r\n */\r\nconst $ = (selector = '*', context = document) => {\r\n\tif (typeof selector === \"string\") {\r\n\t\tselector = selector.trim()\r\n\t\tlet dom = [];\r\n\t\tif (SelectorRegs.id.test(selector)) {\r\n\t\t\tdom = document.getElementById(RegExp.$1)\r\n\t\t\tdom = dom ? [dom] : []\r\n\t\t} else if (SelectorRegs.className.test(selector)) {\r\n\t\t\tdom = context.getElementsByClassName(RegExp.$1)\r\n\t\t} else if (SelectorRegs.tagName.test(selector)) {\r\n\t\t\tdom = context.getElementsByTagName(selector)\r\n\t\t} else {\r\n\t\t\tdom = context.querySelectorAll(selector)\r\n\t\t}\r\n\t\treturn ArrayProto.slice.call(dom)\r\n\t}\r\n\treturn []\r\n}\r\n\r\n\r\n/**\r\n * 对象遍历\r\n * @param  {Object | Array}   object   [对象源]\r\n * @param  {Function} callback [回调]\r\n * @return  \r\n */\r\nconst each = (object, callback) => {\r\n\tif (typeof object === \"object\" && typeof callback === \"function\") {\r\n\t\tif (Array.isArray(object)) {\r\n\t\t\tfor (let i = 0, len = object.length; i < len; i++) {\r\n\t\t\t\tif (callback.call(object[i], i, object[i]) === false) {\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if ('length' in object && typeof object.length === \"number\") { //这地方不太严谨，谨慎使用\r\n\t\t\tfor (let k in object) {\r\n\t\t\t\tif (callback.call(object[k], k, object[k]) === false) {\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 事件绑定，支持代理\r\n * @param  {HTMLElement}   element   [DOM元素]\r\n * @param  {String}   eventType [事件类型]\r\n * @param  {String}   selector  [选择器]\r\n * @param  {Function} callback  [回调]\r\n * @return \r\n */\r\nconst bind = (element, eventType, selector, callback) => {\r\n\tlet sel, handler;\r\n\tif (typeof selector === \"function\") {\r\n\t\thandler = selector\r\n\t} else if (typeof selector === \"string\" && typeof callback === \"function\") {\r\n\t\tsel = selector\r\n\t} else {\r\n\t\treturn\r\n\t}\r\n\tif (sel) { //事件代理\r\n\t\thandler = function(e) {\r\n\t\t\tconst nodes = $(sel, element)\r\n\t\t\tlet matched = false\r\n\t\t\tfor (let i = 0, len = nodes.length; i < len; i++) {\r\n\t\t\t\tconst node = nodes[i]\r\n\t\t\t\tif (node === e.target || node.contains(e.target)) {\r\n\t\t\t\t\tmatched = node\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (matched) {\r\n\t\t\t\tcallback.apply(matched, ArrayProto.slice.call(arguments))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\telement.addEventListener(eventType, handler, false)\r\n}\r\n\r\n\r\n/**\r\n * 事件解绑\r\n * @param  {HTMLElement}   element   [DOM元素]\r\n * @param  {String}   eventType [事件类型]\r\n * @param  {Function} callback  [回调]\r\n * @return \r\n */\r\nconst unbind = (element, eventType, callback) => element.removeEventListener(eventType, callback, false)\r\n\r\n\r\n/**\r\n * 获取指定元素样式\r\n * @param  {HTMLElement} element\r\n * @return {Object}  \r\n */\r\nconst getComputedStyles = element => element.ownerDocument.defaultView.getComputedStyle(element, null)\r\n\r\n\r\n/**\r\n * 对象深度拷贝\r\n * @param  {Object} out\r\n * @return {Object}\r\n */\r\nconst extend = function(out = {}) {\r\n\tfor (let i = 1, len = arguments.length; i < len; i++) {\r\n\t\tlet obj = arguments[i]\r\n\t\tif (!obj || !Object.keys(obj).length)\r\n\t\t\tcontinue\r\n\t\tfor (let key in obj) {\r\n\t\t\tif (obj.hasOwnProperty(key)) {\r\n\t\t\t\tif (isPlainObject(obj[key]))\r\n\t\t\t\t\tout[key] = extend(out[key], obj[key])\r\n\t\t\t\telse\r\n\t\t\t\t\tout[key] = obj[key]\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn out\r\n}\r\n\r\n\r\nconst $on = (elements, eventType, selector, callback) => {\r\n\tif (!Array.isArray(elements)) {\r\n\t\telements = [elements]\r\n\t}\r\n\teach(elements, (index, element) => bind(element, eventType, selector, callback))\r\n}\r\n\r\nconst $off = (elements, eventType, callback) => {\r\n\tif (!Array.isArray(elements)) {\r\n\t\telements = [elements]\r\n\t}\r\n\teach(elements, (index, element) => unbind(element, eventType, callback))\r\n}\r\n\r\nconst classList = (elements, type = 'add', classes = '') => {\r\n\tif (!Array.isArray(elements)) {\r\n\t\telements = [elements]\r\n\t}\r\n\teach(elements, (index, element) => element.classList[type](classes))\r\n}\r\n\r\n\r\nexport default {\r\n\t$,\r\n\teach,\r\n\tbind,\r\n\textend,\r\n\tunbind,\r\n\tgetComputedStyles,\r\n\tclassList,\r\n\t$on,\r\n\t$off,\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/js/utils.js","import '../scss/canvastools.scss'\r\nimport './closet'\r\nimport utils from './utils'\r\nimport Template from './template'\r\n\r\n//stroke类型操作\r\nconst STROKE_TYPES = ['rect', 'ellipse', 'brush', 'arrow', 'mosaic', 'font', 'rubber']\r\n\r\n//默认颜色\r\nconst STROKE_DEFAULT_COLOR = '#fb3838'\r\n\r\n//默认画笔大小\r\nconst STROKE_DEFAULT_WIDTH = 2\r\n\r\n//辅助输入框padding值\r\nconst TEXT_HELPER_PADDING = 2\r\n\r\n//辅助输入框层级\r\nconst TEXT_HELPER_ZINDEX = 1990\r\n\r\n//辅助输入框ID\r\nconst TEXT_HELPER_ID = 'canvas-tools_text_helper'\r\n\r\n//输入框默认字体大小\r\n//以设置的字体大小为准，改值仅做辅助值\r\nconst TEXT_HELPER_FONT_SIZE = 12\r\n\r\n//字体\r\nconst TEXT_FONT_FAMILY = '\"Helvetica Neue\",Helvetica,Arial,\"Hiragino Sans GB\",\"Hiragino Sans GB W3\",\"WenQuanYi Micro Hei\",sans-serif'\r\n\r\n//马赛克模糊度\r\nconst AMBIGUITY_LEVEL = .7\r\n\r\n/**\r\n * 创建画笔+颜色容器\r\n * @param  {Number} stroke [默认画笔]\r\n * @param  {String} color  [默认颜色]\r\n * @return {HTMLElement}   \r\n */\r\nconst buildStrokePanel = (stroke = STROKE_DEFAULT_COLOR, color = STROKE_DEFAULT_COLOR) => {\r\n\tconst el = document.createElement('div')\r\n\tel.className = 'canvas-tools__panel js-panel__stroke'\r\n\tel.style.cssText += 'white-space: nowrap!important;'\r\n\tel.innerHTML = Template.getStrokePanel(stroke) + Template.getColorPanel(color)\r\n\treturn el\r\n}\r\n\r\n/**\r\n * 创建字号+颜色容器\r\n * @param  {Number} fontSize [默认字号]\r\n * @param  {String} color  [默认颜色]\r\n * @return {HTMLElement}   \r\n */\r\nconst buildFontPanel = (fontSize = TEXT_HELPER_FONT_SIZE, color = STROKE_DEFAULT_COLOR) => {\r\n\tconst el = document.createElement('div')\r\n\tel.className = 'canvas-tools__panel js-panel__font'\r\n\tel.style.cssText += 'white-space: nowrap!important;'\r\n\tel.innerHTML = Template.getFontPanel(fontSize) + Template.getColorPanel(color)\r\n\treturn el\r\n}\r\n\r\n\r\nconst buildAmbiguityPanel = (stroke = STROKE_DEFAULT_COLOR, ambiguity = AMBIGUITY_LEVEL) => {\r\n\tconst el = document.createElement('div')\r\n\tel.className = 'canvas-tools__panel js-panel__mosaic'\r\n\tel.style.cssText += 'white-space: nowrap!important;'\r\n\tel.innerHTML = Template.getStrokePanel(stroke) + Template.getAmbiguity(ambiguity)\r\n\treturn el\r\n}\r\n\r\n/**\r\n * 创建辅助文本输入框\r\n * @return {HTMLElement}\r\n */\r\nconst getTextHelper = () => {\r\n\tlet $textHelper = document.getElementById(TEXT_HELPER_ID)\r\n\tif (!$textHelper) {\r\n\t\t$textHelper = document.createElement('div')\r\n\t\t$textHelper.setAttribute('contenteditable', 'plaintext-only')\r\n\t\t$textHelper.setAttribute('spellcheck', 'false')\r\n\t\t$textHelper.setAttribute('id', TEXT_HELPER_ID)\r\n\t\t$textHelper.className = TEXT_HELPER_ID\r\n\t\tdocument.body.appendChild($textHelper)\r\n\t}\r\n\t$textHelper.innerHTML = ''\r\n\t$textHelper.style.cssText = 'display: block';\r\n\treturn $textHelper\r\n}\r\n\r\n/**\r\n * 初始化辅助文本输入框样式\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @param  {Object} state [instance state]\r\n * @param  {Object} rect  [instance rect]\r\n * @return {HTMLElement}   \r\n */\r\nconst insertTextHelper = (event, state, rect) => {\r\n\tconst $textHelper = getTextHelper(),\r\n\t\tthreshold = state.fontSize || TEXT_HELPER_FONT_SIZE,\r\n\t\tpadding = 2 * TEXT_HELPER_PADDING + 2,\r\n\t\tpos = getPos(event, rect)\r\n\r\n\tlet x = event.pageX,\r\n\t\ty = event.pageY,\r\n\t\tmaxW = Math.floor(rect.width - pos.x) - padding,\r\n\t\tmaxH = Math.floor(rect.height - pos.y) - padding\r\n\r\n\tif (maxW <= threshold) {\r\n\t\tx -= (threshold + padding - maxW)\r\n\t\tmaxW = threshold\r\n\t}\r\n\r\n\tif (maxH <= threshold) {\r\n\t\ty -= (threshold + padding - maxH)\r\n\t\tmaxH = threshold\r\n\t}\r\n\r\n\tif (maxW >= rect.width) {\r\n\t\tmaxW = rect.width - pos.x\r\n\t}\r\n\r\n\tif (maxH >= rect.height) {\r\n\t\tmaxH = rect.height - pos.y\r\n\t}\r\n\r\n\tconst styleMap = {\r\n\t\t'font-size': threshold + 'px',\r\n\t\t'line-height': threshold + 'px',\r\n\t\t'min-width': threshold + 'px',\r\n\t\t'min-height': threshold + 'px',\r\n\t\t'max-width': maxW + 'px',\r\n\t\t'max-height': maxH + 'px',\r\n\t\t'z-index': TEXT_HELPER_ZINDEX,\r\n\t\t'font-family': TEXT_FONT_FAMILY,\r\n\t\tdisplay: 'block',\r\n\t\tposition: 'absolute',\r\n\t\ttop: y + 'px',\r\n\t\tleft: x + 'px',\r\n\t\tcolor: state.strokeColor,\r\n\t\tpadding: TEXT_HELPER_PADDING + 'px',\r\n\t\toverflow: 'hidden',\r\n\t}\r\n\r\n\tlet style = ''\r\n\r\n\tfor (let key in styleMap) {\r\n\t\tstyle += `${key}:${styleMap[key]};`\r\n\t}\r\n\r\n\t$textHelper.style.cssText = style\r\n\t$textHelper.focus()\r\n\treturn $textHelper\r\n}\r\n\r\n/**\r\n * 移除辅助文本输入框\r\n * @return \r\n */\r\nconst removeTextHelper = () => {\r\n\tlet $textHelper = document.getElementById(TEXT_HELPER_ID)\r\n\tif (!$textHelper) {\r\n\t\treturn\r\n\t}\r\n\t$textHelper.innerHTML = ''\r\n\t$textHelper.style.cssText = 'display: none';\r\n}\r\n\r\n\r\n/**\r\n * 获取鼠标在Canvas上的位置\r\n * @param  {Element Event} event [鼠标事件]\r\n * @param  {Object} rect  [Canvas rect]\r\n * @return {Object} \r\n */\r\nconst getPos = (event, rect) => {\r\n\tlet x = event.pageX - rect.left\r\n\tlet y = event.pageY - rect.top\r\n\tif (x <= 0) x = 0\r\n\tif (x >= rect.width) x = rect.width\r\n\tif (y <= 0) y = 0\r\n\tif (y >= rect.height) y = rect.height\r\n\r\n\treturn {\r\n\t\tx,\r\n\t\ty\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 默认配置\r\n * @type {Object}\r\n */\r\nconst defaults = {\r\n\t//工具条父级对象容器\r\n\tcontainer: document.body,\r\n\t//显示按钮\r\n\tbuttons: ['rect', 'ellipse', 'brush', 'font', 'mosaic', 'undo', 'save']\r\n}\r\n\r\n//创建一个下载链接\r\nconst $saveLink = document.createElementNS('http://www.w3.org/1999/xhtml', 'a')\r\n\r\n//是否支持原生下载\r\nconst canUseSaveLink = 'download' in $saveLink\r\n\r\n//下载文件\r\nconst __downloadFile = function() {\r\n\tconst fileName = `canvas_${Date.now()}.png`\r\n\tconst canvas = this.canvas\r\n\r\n\tif (canUseSaveLink) {\r\n\t\tlet fileUrl = canvas.toDataURL('png')\r\n\t\tfileUrl = fileUrl.replace('image/png', 'image/octet-stream')\r\n\t\tsetTimeout(() => {\r\n\t\t\t$saveLink.href = fileUrl\r\n\t\t\t$saveLink.download = fileName\r\n\r\n\t\t\t//触发click事件\r\n\t\t\t$saveLink.dispatchEvent(new MouseEvent('click'))\r\n\t\t})\r\n\t}\r\n\r\n\t//for ie 10+ \r\n\telse if (typeof navigator !== \"undefined\" && typeof canvas.msToBlob === 'function' && navigator.msSaveBlob) {\r\n\t\tnavigator.msSaveBlob(canvas.msToBlob(), fileName)\r\n\t}\r\n\r\n\t// other \r\n\telse {\r\n\t\tconsole.log('您的浏览器不支持该操作')\r\n\t}\r\n}\r\n\r\n\r\n//相关事件绑定\r\nfunction __bindEvents() {\r\n\tconst self = this\r\n\tconst {\r\n\t\tcanvas,\r\n\t\tcontext,\r\n\t\t$el,\r\n\t\tstate,\r\n\t\tconfig,\r\n\t\trect,\r\n\t\t_handles,\r\n\t\thistory\r\n\t} = this\r\n\r\n\tconst $btns = utils.$('.js-btn', $el),\r\n\t\t$fontPanel = utils.$('.js-panel__font', $el)[0],\r\n\t\t$strokePanel = utils.$('.js-panel__stroke', $el)[0],\r\n\t\t$mosaicPanel = utils.$('.js-panel__mosaic', $el)[0],\r\n\t\t$colorSelected = utils.$('.js-color-selected', $el),\r\n\t\t$colors = utils.$('.js-color', $el),\r\n\t\t$strokeWidth = utils.$('.js-stroke-width', $el),\r\n\t\t$fontSize = utils.$('.js-font-size', $el),\r\n\t\t$mosaicAmbiguity = utils.$('.js-mosaic-ambiguity', $el)\r\n\r\n\t//按钮事件\r\n\t_handles.btnEmit = function(event) {\r\n\t\tevent.stopPropagation()\r\n\t\tif (state.drawType === 'font') {\r\n\t\t\t__drawFont.call(self, event)\r\n\t\t}\r\n\t\tconst panel = this.getAttribute('data-panel')\r\n\t\tconst value = this.getAttribute('data-value')\r\n\t\tutils.each($btns, (index, $btn) => {\r\n\t\t\tif ($btn !== this) {\r\n\t\t\t\tutils.classList($btn, 'remove', 'active')\r\n\t\t\t}\r\n\t\t})\r\n\t\tif (!!~STROKE_TYPES.indexOf(value)) {\r\n\t\t\tstate.drawType = value\r\n\t\t}\r\n\t\tif (panel) {\r\n\t\t\tutils.classList(this, 'toggle', 'active')\r\n\t\t\tconst isActive = /active/.test(this.className)\r\n\t\t\tconst visible = isActive ? 'block' : 'none'\r\n\t\t\tif (panel === 'stroke') {\r\n\t\t\t\t$fontPanel.style.display = 'none'\r\n\t\t\t\t$mosaicPanel.style.display = 'none'\r\n\t\t\t\t$strokePanel.style.display = visible\r\n\t\t\t} else if (panel === 'font') {\r\n\t\t\t\t$fontPanel.style.display = visible\r\n\t\t\t\t$strokePanel.style.display = 'none'\r\n\t\t\t\t$mosaicPanel.style.display = 'none'\r\n\t\t\t} else if (panel === 'mosaic') {\r\n\t\t\t\t$mosaicPanel.style.display = visible\r\n\t\t\t\t$fontPanel.style.display = 'none'\r\n\t\t\t\t$strokePanel.style.display = 'none'\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//$fontPanel.style.display = 'none'\r\n\t\t\t//$strokePanel.style.display = 'none'\r\n\t\t}\r\n\r\n\t\tif (value === 'save') {\r\n\t\t\t__downloadFile.call(self)\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t//history[0]是画布的初始状态\r\n\t\t//因此只有多于1个历史记录时才可以恢复上一步\r\n\t\tif (value === 'undo' && history.length > 1) {\r\n\t\t\thistory.pop()\r\n\t\t\tcontext.putImageData(history[history.length - 1], 0, 0, 0, 0, rect.width, rect.height)\r\n\t\t}\r\n\r\n\t\t__toggleCanvasCursor.call(self)\r\n\t}\r\n\r\n\t_handles.toggleColor = function(event) {\r\n\t\tconst color = this.getAttribute('data-value')\r\n\t\tstate.strokeColor = color\r\n\t\tutils.each($colorSelected, (index, item) => item.style.background = color)\r\n\t}\r\n\r\n\t_handles.toggleStrokeWidth = function(event) {\r\n\t\tstate.strokeWidth = Number(this.getAttribute('data-value'))\r\n\t\tutils.each($strokeWidth, (index, item) => {\r\n\t\t\tconst value = Number(item.getAttribute('data-value'))\r\n\t\t\tconst method = value === state.strokeWidth ? 'add' : 'remove'\r\n\t\t\tutils.classList(item, method, 'active')\r\n\t\t})\r\n\t}\r\n\r\n\t_handles.toggleFontSize = function(event) {\r\n\t\tstate.fontSize = Number(this.value)\r\n\t}\r\n\r\n\t//鼠标在画布上的初始位置\r\n\tlet _startPos\r\n\r\n\t_handles.onMouseDown = function(event) {\r\n\t\tif (!!~STROKE_TYPES.indexOf(state.drawType) === false || state.drawType === 'font') {\r\n\t\t\treturn\r\n\t\t}\r\n\t\t_startPos = getPos(event, rect)\r\n\r\n\t\t//保存当前快照\r\n\t\tstate.lastImageData = context.getImageData(0, 0, rect.width, rect.height)\r\n\r\n\t\t//初始化context状态\r\n\t\tcontext.lineCap = 'round'\r\n\t\tcontext.lineJoin = 'round'\r\n\t\tcontext.shadowBlur = 0\r\n\t\tcontext.strokeStyle = state.strokeColor\r\n\t\tcontext.lineWidth = state.strokeWidth\r\n\t\tswitch (state.drawType) {\r\n\t\t\tcase 'rect':\r\n\t\t\t\t__drawRect.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t\tcase 'ellipse':\r\n\t\t\t\t__drawEllipse.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t\tcase 'mosaic':\r\n\t\t\t\t__drawMoasic.call(self, event)\r\n\t\t\t\tbreak\r\n\t\t\tcase 'brush':\r\n\t\t\tdefault:\r\n\t\t\t\t__drawBrush.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t}\r\n\r\n\t\tutils.$on(document, 'mousemove', _handles.onMouseMove)\r\n\t\tutils.$on(document, 'mouseup', _handles.onMouseUp)\r\n\t}\r\n\r\n\t_handles.onMouseMove = function(event) {\r\n\t\tif (!!~STROKE_TYPES.indexOf(state.drawType) === false || state.drawType === 'font') {\r\n\t\t\treturn\r\n\t\t}\r\n\t\tswitch (state.drawType) {\r\n\t\t\tcase 'rect':\r\n\t\t\t\t__drawRect.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t\tcase 'ellipse':\r\n\t\t\t\t__drawEllipse.call(self, event, _startPos)\r\n\t\t\t\tbreak\r\n\t\t\tcase 'mosaic':\r\n\t\t\t\t__drawMoasic.call(self, event)\r\n\t\t\t\tbreak\r\n\t\t\tcase 'brush':\r\n\t\t\tdefault:\r\n\t\t\t\t__drawBrush.call(self, event, null)\r\n\t\t\t\tbreak\r\n\t\t}\r\n\t}\r\n\r\n\t_handles.onMouseUp = function(event) {\r\n\t\tutils.$off(document, 'mousemove', _handles.onMouseMove)\r\n\t\tutils.$off(document, 'mouseup', _handles.onMouseUp)\r\n\t\tif (!!~STROKE_TYPES.indexOf(state.drawType) && state.drawType !== 'font') {\r\n\t\t\t__pushHistory.call(self)\r\n\t\t}\r\n\t}\r\n\r\n\t_handles.insertTextHelper = function(event) {\r\n\t\tevent.stopPropagation()\r\n\t\tif (state.drawType !== 'font') {\r\n\t\t\treturn\r\n\t\t}\r\n\t\tif (state.isEntry) {\r\n\t\t\t__drawFont.call(self, event)\r\n\t\t\treturn\r\n\t\t}\r\n\t\tinsertTextHelper(event, state, rect)\r\n\t\tstate.isEntry = true\r\n\t}\r\n\r\n\t_handles.removeTextHelper = function(event) {\r\n\t\tif (state.drawType !== 'font') {\r\n\t\t\tremoveTextHelper()\r\n\t\t} else if (!event.target.closest('#canvas-tools-input')) {\r\n\t\t\t__drawFont.call(self, event)\r\n\t\t}\r\n\t}\r\n\r\n\t_handles.resize = function(event) {\r\n\t\tconst _rect = canvas.getBoundingClientRect()\r\n\t\trect.width = canvas.width\r\n\t\trect.height = canvas.height\r\n\t\trect.offsetWidth = canvas.offsetWidth\r\n\t\trect.offsetHeight = canvas.offsetHeight\r\n\t\trect.top = _rect.top\r\n\t\trect.left = _rect.left\r\n\t\tstate.drawType === 'font' && state.isEntry && __drawFont.call(self, event)\r\n\t}\r\n\r\n\t_handles.toggleAmbiguity = function(event) {\r\n\t\tstate.ambiguity = this.value\r\n\t\tconsole.log(state)\r\n\t}\r\n\r\n\t//按钮事件\r\n\tutils.$on($btns, 'click', _handles.btnEmit)\r\n\r\n\t//切换颜色\r\n\tutils.$on($colors, 'click', _handles.toggleColor)\r\n\r\n\t//切换画笔大小\r\n\tutils.$on($strokeWidth, 'click', _handles.toggleStrokeWidth)\r\n\r\n\t//切换字体大小\r\n\tutils.$on($fontSize, 'change', _handles.toggleFontSize)\r\n\r\n\tutils.$on($mosaicAmbiguity, 'change', _handles.toggleAmbiguity)\r\n\r\n\t//矩形，椭圆，画笔等绘制\r\n\tutils.$on(canvas, 'mousedown', _handles.onMouseDown)\r\n\r\n\t//插入文本辅助框\r\n\tutils.$on(canvas, 'click', _handles.insertTextHelper)\r\n\r\n\t//移除文本辅助框\r\n\tutils.$on(document, 'click', _handles.removeTextHelper)\r\n\r\n\t//window resize\r\n\twindow.addEventListener('resize', _handles.resize)\r\n}\r\n\r\n/**\r\n * 绘制矩形\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @param  {Object} start [起始位置]\r\n * @return \r\n */\r\nfunction __drawRect(event, start) {\r\n\tconst {\r\n\t\tcontext,\r\n\t\trect,\r\n\t\tstate\r\n\t} = this\r\n\tconst pos = getPos(event, rect)\r\n\tlet width = pos.x - start.x\r\n\tlet height = pos.y - start.y\r\n\tcontext.clearRect(0, 0, rect.width, rect.height)\r\n\tcontext.putImageData(state.lastImageData, 0, 0, 0, 0, rect.width, rect.height)\r\n\tcontext.save()\r\n\tcontext.beginPath()\r\n\tcontext.strokeRect(start.x, start.y, width, height)\r\n\tcontext.restore()\r\n\tcontext.closePath()\r\n}\r\n\r\n\r\n/**\r\n * 绘制椭圆\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @param  {Object} start [起始位置]\r\n * @return \r\n */\r\nfunction __drawEllipse(event, start) {\r\n\tconst {\r\n\t\tcontext,\r\n\t\trect,\r\n\t\tstate\r\n\t} = this\r\n\tconst pos = getPos(event, rect)\r\n\tlet scaleX = 1 * ((pos.x - start.x) / 2)\r\n\tlet scaleY = 1 * ((pos.y - start.y) / 2)\r\n\tlet x = (start.x / scaleX) + 1\r\n\tlet y = (start.y / scaleY) + 1\r\n\tcontext.clearRect(0, 0, rect.width, rect.height)\r\n\tcontext.putImageData(state.lastImageData, 0, 0, 0, 0, rect.width, rect.height)\r\n\tcontext.save()\r\n\tcontext.beginPath()\r\n\tcontext.scale(scaleX, scaleY)\r\n\tcontext.arc(x, y, 1, 0, 2 * Math.PI)\r\n\tcontext.restore()\r\n\tcontext.closePath()\r\n\tcontext.stroke()\r\n}\r\n\r\n/**\r\n * 画笔工具自由绘制\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @param  {Object | null} start [起始位置]\r\n * @return \r\n */\r\nfunction __drawBrush(event, start = null) {\r\n\tconst {\r\n\t\tcontext,\r\n\t\trect\r\n\t} = this\r\n\tif (start) {\r\n\t\tcontext.beginPath()\r\n\t\tcontext.moveTo(start.x, start.y)\r\n\t} else {\r\n\t\tconst pos = getPos(event, rect)\r\n\t\tcontext.lineTo(pos.x, pos.y)\r\n\t\tcontext.stroke()\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 绘制文字\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @return {[type]} \r\n */\r\nfunction __drawFont(event) {\r\n\tconst $textHelper = document.getElementById(TEXT_HELPER_ID)\r\n\tif (!$textHelper) {\r\n\t\tthis.state.isEntry = false\r\n\t\treturn\r\n\t}\r\n\tconst content = $textHelper.textContent.trim()\r\n\tconst length = content.length\r\n\tif (!content || !length) {\r\n\t\tthis.state.isEntry = false\r\n\t\tremoveTextHelper()\r\n\t\treturn\r\n\t}\r\n\tconst style = utils.getComputedStyles($textHelper),\r\n\t\tthreshold = this.state.fontSize || TEXT_HELPER_FONT_SIZE,\r\n\t\tpadding = 2 * TEXT_HELPER_PADDING,\r\n\t\tcontext = this.context\r\n\r\n\tlet x = parseFloat(style.left) - this.rect.left + padding - 2,\r\n\t\ty = parseFloat(style.top) - this.rect.top + threshold,\r\n\t\tlineWidth = 0,\r\n\t\tlastSubStrIndex = 0\r\n\r\n\tcontext.beginPath()\r\n\tcontext.save()\r\n\tcontext.fillStyle = this.state.strokeColor\r\n\tcontext.font = `${this.state.fontSize}px ${TEXT_FONT_FAMILY}`\r\n\r\n\tfor (let i = 0; i < length; i++) {\r\n\t\tlet char = content[i]\r\n\r\n\t\t//让文字自动换行\r\n\t\tlineWidth += context.measureText(char).width\r\n\t\tif (lineWidth > this.rect.width - x) {\r\n\t\t\tcontext.fillText(content.substring(lastSubStrIndex, i), x, y)\r\n\t\t\ty += threshold\r\n\t\t\tlineWidth = 0\r\n\t\t\tlastSubStrIndex = i\r\n\t\t}\r\n\t\tif (i == length - 1) {\r\n\t\t\tcontext.fillText(content.substring(lastSubStrIndex, i + 1), x, y);\r\n\t\t}\r\n\t}\r\n\tcontext.restore()\r\n\tcontext.closePath()\r\n\tthis.state.isEntry = false\r\n\tremoveTextHelper()\r\n\t__pushHistory.call(this)\r\n}\r\n\r\n\r\n/**\r\n * 绘制马赛克\r\n * @param  {MouseEvent} event [鼠标事件]\r\n * @return {[type]} \r\n */\r\nfunction __drawMoasic(event) {\r\n\tconst {\r\n\t\tcontext,\r\n\t\tstate,\r\n\t\trect\r\n\t} = this\r\n\tconst pos = getPos(event, rect)\r\n\r\n\t//获取当前位置1PX的颜色值\r\n\tconst pixel = context.getImageData(pos.x, pos.y, 1, 1).data\r\n\tconst color = `rgba(${pixel[0]}, ${pixel[1]}, ${pixel[2]}, ${state.ambiguity})`\r\n\tconst size = state.strokeWidth * 3.5 \r\n\tcontext.beginPath()\r\n\tcontext.save()\r\n\tcontext.fillStyle = color\r\n\tcontext.fillRect(pos.x, pos.y, size, size)\r\n\tcontext.restore()\r\n}\r\n\r\n\r\n/**\r\n * 切换鼠标指针\r\n * @return \r\n */\r\nfunction __toggleCanvasCursor() {\r\n\tconst canvas = this.canvas\r\n\tlet cursor\r\n\tswitch (this.state.drawType) {\r\n\t\tcase 'brush':\r\n\t\t\tcursor = 'brush'\r\n\t\t\tbreak\r\n\t\tcase 'font':\r\n\t\t\tcursor = 'font'\r\n\t\t\tbreak\r\n\t\tcase 'mosaic':\r\n\t\t\tcursor = 'mosaic'\r\n\t\t\tbreak\r\n\t\tcase 'rect':\r\n\t\tcase 'ellipse':\r\n\t\t\tcursor = 'crosshair'\r\n\t\t\tbreak\r\n\t\tdefault:\r\n\t\t\tcursor = 'default'\r\n\t}\r\n\tif (cursor) {\r\n\t\tcanvas.className = canvas.className.replace(/canvas-cursor__(\\w+)/, '').trim() + ` canvas-cursor__${cursor}`\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 保存到历史记录\r\n * @return  \r\n */\r\nfunction __pushHistory() {\r\n\tthis.history.push(this.context.getImageData(0, 0, this.rect.width, this.rect.height))\r\n}\r\n\r\n/**\r\n * CanvasTools\r\n * Class\r\n */\r\nclass CanvasTools {\r\n\r\n\t/**\r\n\t * constructor\r\n\t * @param  {CanvasElement} canvas  [canvas element object]\r\n\t * @param  {Object} options [config]\r\n\t * @return {Object}         [instance]\r\n\t */\r\n\tconstructor(canvas, options) {\r\n\t\tif (!canvas || typeof canvas.getContext !== 'function') {\r\n\t\t\tthrow new Error('invalid canvas object')\r\n\t\t}\r\n\t\tthis.canvas = canvas\r\n\t\tthis.context = canvas.getContext('2d')\r\n\t\tthis.config = utils.extend({}, defaults, options || {})\r\n\r\n\t\tthis.history = []\r\n\t\tthis.state = Object.create(null)\r\n\t\tthis.rect = Object.create(null)\r\n\t\tthis._handles = Object.create(null)\r\n\r\n\t\tthis.state.strokeWidth = STROKE_DEFAULT_WIDTH\r\n\t\tthis.state.fontSize = TEXT_HELPER_FONT_SIZE\r\n\t\tthis.state.strokeColor = STROKE_DEFAULT_COLOR\r\n\t\tthis.state.ambiguity = AMBIGUITY_LEVEL\r\n\t\tthis.state.drawType = 'brush'\r\n\t\tthis.state.isEntry = false\r\n\r\n\t\tthis.rect.width = canvas.width\r\n\t\tthis.rect.height = canvas.height\r\n\r\n\t\tthis.rect.offsetWidth = canvas.offsetWidth\r\n\t\tthis.rect.offsetHeight = canvas.offsetHeight\r\n\r\n\t\tconst rect = canvas.getBoundingClientRect()\r\n\t\tthis.rect.top = rect.top\r\n\t\tthis.rect.left = rect.left\r\n\r\n\t\t//保存现场\r\n\t\tthis.state.lastImageData = this.context.getImageData(0, 0, this.rect.width, this.rect.height)\r\n\r\n\t\t//将画布的初始状态保存到历史记录\r\n\t\t__pushHistory.call(this)\r\n\r\n\t\t__toggleCanvasCursor.call(this)\r\n\r\n\t\tthis.render()\r\n\t}\r\n\r\n\t/**\r\n\t * 初始化工具条到DOM\r\n\t * @return\r\n\t */\r\n\trender() {\r\n\t\tconst C = this.config\r\n\t\tconst S = this.state\r\n\t\tlet el = document.createElement('div')\r\n\t\tel.className = 'canvas-tools'\r\n\t\tel.innerHTML = Template.getButtons(C.buttons)\r\n\t\tC.container.appendChild(el)\r\n\r\n\t\tthis.$el = el\r\n\t\tthis.$el.appendChild(buildStrokePanel(S.strokeWidth, S.strokeColor))\r\n\t\tthis.$el.appendChild(buildFontPanel(S.fontSize, S.strokeColor))\r\n\t\tthis.$el.appendChild(buildAmbiguityPanel(S.ambiguity, S.strokeColor))\r\n\t\t__bindEvents.call(this)\r\n\t}\r\n\r\n\trefresh() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * destory\r\n\t * @return \r\n\t */\r\n\tdestory() {\r\n\t\tconst {\r\n\t\t\tcanvas,\r\n\t\t\t$el,\r\n\t\t\t_handles\r\n\t\t} = this\r\n\r\n\t\tconst $btns = utils.$('.js-btn', $el),\r\n\t\t\t$colors = utils.$('.js-color', $el),\r\n\t\t\t$strokeWidth = utils.$('.js-stroke-width', $el),\r\n\t\t\t$fontSize = utils.$('.js-font-size', $el),\r\n\t\t\t$mosaicAmbiguity = utils.$('.js-mosaic-ambiguity', $el),\r\n\t\t\t$textHelper = document.getElementById(TEXT_HELPER_ID)\r\n\r\n\t\tutils.$off($btns, 'click', _handles.btnEmit)\r\n\t\tutils.$off($colors, 'click', _handles.toggleColor)\r\n\t\tutils.$off($strokeWidth, 'click', _handles.toggleStrokeWidth)\r\n\t\tutils.$off($fontSize, 'change', _handles.toggleFontSize)\r\n\t\tutils.$off($mosaicAmbiguity, 'change', _handles.toggleAmbiguity)\r\n\t\tutils.$off(canvas, 'mousedown', _handles.onMouseDown)\r\n\t\tutils.$off(canvas, 'click', _handles.insertTextHelper)\r\n\t\tutils.$off(document, 'click', _handles.removeTextHelper)\r\n\t\twindow.removeEventListener('resize', _handles.resize)\r\n\t\t$textHelper && $textHelper.parentNoed.removeChild($textHelper)\r\n\t\tthis.canvas = null\r\n\t\tthis.context = null\r\n\t\tthis.history.length = 0\r\n\t\tthis.config.container.removeChild(this.$el)\r\n\t}\r\n\r\n}\r\n\r\nexport default CanvasTools\n\n\n// WEBPACK FOOTER //\n// ./src/js/main.js"],"sourceRoot":""}